(this["webpackJsonpmusic-player"]=this["webpackJsonpmusic-player"]||[]).push([[0],[,,,,,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/play.53d7188e.svg"},function(e,t,n){e.exports=n.p+"static/media/pause.c7564688.svg"},function(e,t,n){e.exports=n.p+"static/media/spinner.2f27f045.ico"},function(e,t,n){e.exports=n(26)},,,,,function(e,t,n){},,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(10),s=n.n(r),o=(n(20),n(7)),l=n.n(o),c=n(5),u=n(1),h=n(2),d=n(4),m=n(3),p=n(11),y=n(6),f=n.n(y),v=n(8),g=n.n(v),w=(n(24),n(25),n(12)),P=n.n(w),b=n(13),k=n.n(b),S=n(14),E=n.n(S),F=function(){function e(t){Object(u.a)(this,e),this.audioContext=new AudioContext,this.lowPassFilter=this.audioContext.createBiquadFilter(),this.lowPassFilter.type="lowpass",this.highPassFilter=this.audioContext.createBiquadFilter(),this.highPassFilter.type="highpass",this.lowFreqAnalyser=this.audioContext.createAnalyser(),this.lowFreqAnalyser.fftSize=2048,this.highFreqAnalyser=this.audioContext.createAnalyser(),this.highFreqAnalyser.fftSize=2048,this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.lowPassFilter),this.source.connect(this.highPassFilter),this.lowPassFilter.connect(this.lowFreqAnalyser),this.highPassFilter.connect(this.highFreqAnalyser),this.source.connect(this.audioContext.destination)}return Object(h.a)(e,[{key:"getColor",value:function(){var e=this.lowFreqAnalyser.frequencyBinCount,t=new Uint8Array(e),n=new Uint8Array(e);this.lowFreqAnalyser.getByteTimeDomainData(t),this.highFreqAnalyser.getByteTimeDomainData(n);var a=Math.max.apply(Math,Object(c.a)(t)),i=128+Math.min(Math.exp((a-128)/10),128),r=Math.max.apply(Math,Object(c.a)(n)),s=128+Math.min(Math.exp((r-128)/10),128),o=(i+s)/2;return"rgb(".concat(i,", ").concat(s,", ").concat(o,")")}}]),e}(),C=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).onAudioElementRefAvailable=function(e){a.props.doVisualization&&null!==e&&(a.visualizer=new F(e),a.currentAnimationId=requestAnimationFrame(a.draw))},a.draw=function(){document.body.style.backgroundColor=a.visualizer.getColor(),a.currentAnimationId=requestAnimationFrame(a.draw)},a.state={loadingStatus:e.isPlaying?"loading":null},a.audioElement=null,a.canvas=i.a.createRef(),a.currentAnimationId=null,a}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){this.currentIntervalId&&clearInterval(this.currentIntervalId),this.stopVisualization()}},{key:"render",value:function(){var e=this,t=this.props.isPlaying?"filename playing":"filename";return this.props.isPlaying?"loading"===this.state.loadingStatus?i.a.createElement("div",{className:"Audio",onClick:function(){return e.onPausePressed()}},i.a.createElement("div",{className:"icon-container loading-spinner",role:"button"},i.a.createElement("img",{src:E.a,className:"spinner",alt:"","aria-label":"Play"}),i.a.createElement("audio",{autoPlay:!0,crossOrigin:"anonymous",onCanPlay:function(){return e.onLoadingFinished()}},i.a.createElement("source",{src:this.props.url}))),i.a.createElement("div",{className:t},this.props.filename)):"loaded"===this.state.loadingStatus?i.a.createElement("div",{className:"Audio",onClick:function(){return e.onPausePressed()}},i.a.createElement("div",{className:"icon-container play-pause",role:"button"},i.a.createElement("img",{src:k.a,className:"pause-symbol",alt:"","aria-label":"Pause"}),i.a.createElement("audio",{ref:this.onAudioElementRefAvailable,crossOrigin:"anonymous",autoPlay:!0,onEnded:function(){return e.props.onEnded()}},i.a.createElement("source",{src:this.props.url}))),i.a.createElement("div",{className:t},this.props.filename)):void 0:i.a.createElement("div",{className:"Audio",onClick:function(){return e.onPlayPressed()}},i.a.createElement("div",{className:"icon-container play-pause",role:"button"},i.a.createElement("img",{src:P.a,className:"play-symbol",alt:"","aria-label":"Play"})),i.a.createElement("div",{className:t},this.props.filename))}},{key:"onPlayPressed",value:function(){this.props.onPlayPressed()}},{key:"onLoadingFinished",value:function(){this.setState({loadingStatus:"loaded"})}},{key:"onPausePressed",value:function(){this.stopVisualization(),this.props.onPausePressed()}},{key:"stopVisualization",value:function(){document.body.style.backgroundColor="",cancelAnimationFrame(this.currentAnimationId),this.currentAnimationId=null}}]),n}(i.a.Component),x=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).handleOnPopState=function(e){var t="";e.state&&(t=e.state.searchString),a.setState({searchString:t}),a.doSearch(t)},a.handleKeyDown=function(e){"Control"===e.key&&a.setState({ctrlKeyDepressed:!0})},a.handleKeyUp=function(e){"Control"===e.key&&a.setState({ctrlKeyDepressed:!1})},a.renderFile=function(e){var t=a.state.currentlyPlaying.includes(e),n="".concat(e,"-").concat(t),r=a.props.s3Url+encodeURIComponent(e);return i.a.createElement("div",{className:"file-container",key:e},i.a.createElement(C,{url:r,isPlaying:t,key:n,filename:e,doVisualization:a.state.partyMode,onPlayPressed:function(){return a.startPlaying(e)},onPausePressed:function(){return a.stopPlaying(e)},onEnded:function(){return a.onEnded(e)}}),i.a.createElement("a",{className:"lyrics-link",target:"_blank",rel:"noopener noreferrer",href:a.lyricsUrlFromFilename(e)},"Lyrics"))},a.state={visibleFiles:null===e.filenames?null:[],searchString:e.searchString||"",currentlyPlaying:[],ctrlKeyDepressed:!1,partyMode:!1},a.searchBoxRef=i.a.createRef(),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("popstate",this.handleOnPopState),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("popstate",this.handleOnPopState),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),this.currentTimeoutId&&clearTimeout(this.currentTimeoutId)}},{key:"componentDidUpdate",value:function(e,t,n){g.a.isEqual(this.props.filenames,e.filenames)||this.doSearch(this.state.searchString)}},{key:"render",value:function(){var e=this,t=this.state.visibleFiles,n=i.a.createElement("span",null,"Loading..."),a=/Mobi|Android/i.test(navigator.userAgent),r=i.a.createElement("button",{onClick:function(){return e.onNewClicked()}},"New Search"),s=this.state.partyMode?"ON":"OFF",o=i.a.createElement("span",{className:"party-mode-toggle"},"Party mode",i.a.createElement("button",{className:"party-mode-toggle-button",onClick:function(){return e.setState({partyMode:!e.state.partyMode})}},s));return i.a.createElement("div",{className:"SongList"},i.a.createElement("div",{className:"header"},i.a.createElement("input",{placeholder:"Search...",autoFocus:!0,value:this.state.searchString,role:"searchbox",spellCheck:"false",className:"search-box",ref:this.searchBoxRef,onFocus:function(e){return e.target.select()},onChange:function(t){return e.onSearchTermChanged(t.target.value)}}),a?r:null,o),i.a.createElement("div",{style:{marginTop:"1rem"}},t&&t.map(this.renderFile)||n))}},{key:"onNewClicked",value:function(){this.searchBoxRef.current.select()}},{key:"lyricsUrlFromFilename",value:function(e){var t=e.split("/");if(t.length<2)return null;var n=t[0],a=t[t.length-1].replace(/\d+( -)? /g,"");a=a.replace(/\.mp3/,"");var i=function(e){return e.replace(/ +/g,"-")};n=i(n),a=i(a);var r=/[(!?.)]/g;return n=n.replace(r,""),a=a.replace(r,""),"https://genius.com/".concat(n,"-").concat(a,"-lyrics")}},{key:"onSearchTermChanged",value:function(e){var t=this;this.setState({searchString:e}),this.currentTimeoutId&&clearTimeout(this.currentTimeoutId);this.currentTimeoutId=setTimeout((function(){t.doSearch(e),t.saveSearchString(e)}),750)}},{key:"doSearch",value:function(e){var t=e.toLowerCase();if(""!==t){var n=this.props.filenames.filter((function(e){return e.toLowerCase().includes(t)}));this.setState({visibleFiles:n})}else this.setState({visibleFiles:[]})}},{key:"saveSearchString",value:function(e){var t=new URLSearchParams(window.location.search);t.set("search",e),window.history.pushState({searchString:e},"",window.location.origin+window.location.pathname+"?"+t.toString())}},{key:"onEnded",value:function(e){var t=this,n=this.state.visibleFiles.indexOf(e)+1,a=this.state.currentlyPlaying;if(a=a.filter((function(t){return t!==e})),n<this.state.visibleFiles.length){var i=this.state.visibleFiles[n];a.push(i)}this.setState({currentlyPlaying:a},(function(){return t.setDocumentTitle()}))}},{key:"startPlaying",value:function(e){var t,n=this;t=this.state.ctrlKeyDepressed?this.state.currentlyPlaying.concat([e]):[e],this.setState({currentlyPlaying:t},(function(){return n.setDocumentTitle()}))}},{key:"stopPlaying",value:function(e){var t=this;this.setState({currentlyPlaying:this.state.currentlyPlaying.filter((function(t){return t!==e}))},(function(){return t.setDocumentTitle()}))}},{key:"setDocumentTitle",value:function(){var e=this.state.currentlyPlaying[0],t=e&&g.a.last(e.split("/"));document.title=t?"\ud83c\udfb6 \u2014 ".concat(t):"\ud83c\udfb6"}}]),n}(i.a.Component),A="https://elis-music.s3.us-east-2.amazonaws.com/";function O(){return(O=Object(p.a)(l.a.mark((function e(){var t,n,a,i,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=null;case 2:return a="list-type=2",n&&(a+="&continuation-token=".concat(encodeURIComponent(n))),e.next=7,fetch(A+"?"+a);case 7:return i=e.sent,e.next=10,i.text();case 10:if(r=e.sent,s=f()(r).find("Contents > Key").toArray().map((function(e){return e.textContent})),t.push.apply(t,Object(c.a)(s)),"true"===f()(r).find("IsTruncated").text()){e.next=15;break}return e.abrupt("break",18);case 15:n=f()(r).find("NextContinuationToken").text(),e.next=2;break;case 18:return e.abrupt("return",t);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={keys:null},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;(function(){return O.apply(this,arguments)})().then((function(t){return e.setState({keys:t})}))}},{key:"render",value:function(){var e=new URLSearchParams(window.location.search).get("search");return i.a.createElement(x,{filenames:this.state.keys,s3Url:A,searchString:e})}}]),n}(i.a.Component);s.a.render(i.a.createElement(N,null),document.getElementById("root"))}],[[15,1,2]]]);
//# sourceMappingURL=main.297e4c7c.chunk.js.map